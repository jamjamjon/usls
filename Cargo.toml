[package]
name = "usls"
edition = "2021"
version = "0.2.0-alpha.1"
rust-version = "1.87"
description = "A Rust library integrated with ONNXRuntime, providing a collection of ML models."
repository = "https://github.com/jamjamjon/usls"
authors = ["Jamjamjon <xxyydzml@outlook.com>"]
license = "MIT"
readme = "README.md"
exclude = ["assets/*", "examples/*", "runs/*", "benches/*", "tests/*"]


[dependencies]
anyhow = { version = "1" }
aksr = { version = "0.0.7" }
ab_glyph = { version = "0.2.32" }
image = { version = "0.25", default-features = false, features = [
  "jpeg", "png", "gif", "webp", "bmp", "ico", "rayon"
] }
imageproc = { version = "0.25", default-features = false, features = ["rayon"] }
ndarray = { version = "0.16.1", features = ["rayon"] }
half = { version = "2.7.1", features = ["bytemuck", "num-traits"] }
indicatif = { version = "0.18", default-features = false }
tracing = { version = "0.1" }
prost = { version = "0.14.1" }
paste = { version = "1.0.15" }
rand = { version = "0.9" }
serde = { version = "1.0", features = ["derive"] }
serde_json = { version = "1.0" }
rayon = { version = "1.10.0" }
glob = { version = "0.3.3" }
dirs = { version = "6.0.0" }
chrono = { version = "0.4.40", default-features = false, features = ["clock", "std"] }
regex = { version = "1.12.2" }
tempfile = { version = "3.23.0" }
fast_image_resize = { version = "5.4.0", default-features = false, features = ["image", "rayon"] }
minifb = { version = "0.28.0", optional = true }
video-rs = { version = "0.10.5", features = ["ndarray"], optional = true }
ndarray-npy = { version = "0.9.1", optional = true  }
ort = { version = "=2.0.0-rc.10", default-features = false, optional = true, features = [
  "copy-dylibs",
  "half",
  "std",
] }
hf-hub = { version = "0.4.3", default-features = false, features = ["ureq", "native-tls"], optional = true }
tokenizers = { version = "0.22.1", optional = true }
lru = { version = "0.16.2", default-features = false }
http = { version = "1.3", optional = true }
ureq = { version = "3", default-features = false, features = ["rustls", "gzip"], optional = true }
# Workaround: Pin zune-jpeg to 0.5.5 due to a macOS-specific bug in 0.5.6
zune-jpeg = "=0.5.5"
num-traits = "0.2.19"
cudarc = { version = "0.18.2", optional = true, default-features = false, features = [
  "driver", 
  "nvrtc", 
  "dynamic-linking",
  # "cuda-12040",
  "cuda-version-from-build-system"
] }
wgpu = { version = "23", optional = true, default-features = false, features = ["wgsl"] }
pollster = { version = "0.4", optional = true }
bytemuck = { version = "1.19", features = ["derive"] }

[dev-dependencies]
argh = { version = "0.1.13" }
tracing-subscriber = { version = "0.3.18", features = ["env-filter", "chrono", "fmt", "ansi"] }


[profile.dev]
opt-level = 0
incremental = true
debug = 1

[profile.release]
opt-level = 3
lto = "fat"
codegen-units = 1
panic = "abort"
debug = false
strip = true


[features]
default = ["ort-download-binaries", "vision", "github"]

# Utility features
video = ["dep:video-rs"]
viewer = ["dep:minifb"]

# ONNX Runtime features
ort-download-binaries = ["ort", "ort/download-binaries"]
ort-load-dynamic = ["ort", "ort/load-dynamic"]

# ONNX Runtime execution providers
acl = ["ort/acl"]
armnn = ["ort/armnn"]
azure = ["ort/azure"]
cann = ["ort/cann"]
coreml = ["ort/coreml"]
cuda = ["ort/cuda", "dep:cudarc"]
wgpu = ["dep:wgpu", "dep:pollster", "ort/webgpu"]
directml = ["ort/directml"]
migraphx = ["ort/migraphx"]
nnapi = ["ort/nnapi"]
onednn = ["ort/onednn"]
openvino = ["ort/openvino"]
qnn = ["ort/qnn"]
rknpu = ["ort/rknpu"]
rocm = ["ort/rocm"]
tensorrt = ["ort/tensorrt"]
tvm = ["ort/tvm"]
vitis = ["ort/vitis"]
xnnpack = ["ort/xnnpack"]

# Hugging Face hub support (for downloading models from Hugging Face)
hf-hub = ["dep:hf-hub"]
# GitHub support (for downloading models from GitHub Releases)
github = ["dep:ureq", "dep:http"]

# =============================================================================
# Model Category Features
# =============================================================================

# Vision models - pure image processing (detection, segmentation, classification, etc.)
# Includes: YOLO, SAM, RT-DETR, RTMPose, DepthAnything, CLIP, BLIP, etc.
vision = []

# Vision-Language models - multimodal understanding (requires tokenizers)
# Includes: CLIP, BLIP, Florence2, GroundingDINO, Moondream2, OWL, SAM3, SmolVLM, TrOCR, YOLO-E, FastVLM
vlm = ["vision", "dep:tokenizers", "ndarray-npy"]

# Multi-object tracking utilities (ByteTrack, etc.)
mot = []

# Enable all models (vision + vlm + mot)
all-models = ["vision", "vlm", "mot"]


[[example]]
name = "read_video"
required-features = ["video"]

[[example]]
name = "imshow"
required-features = ["viewer"]

# Vision model examples
[[example]]
name = "apisr"
required-features = ["vision"]

[[example]]
name = "ben2"
required-features = ["vision"]

[[example]]
name = "blip"
required-features = ["vlm"]

[[example]]
name = "classifier"
required-features = ["vision"]

[[example]]
name = "clip"
required-features = ["vlm"]

[[example]]
name = "d-fine"
required-features = ["vision"]

[[example]]
name = "db"
required-features = ["vision"]

[[example]]
name = "deim"
required-features = ["vision"]

[[example]]
name = "deimv2"
required-features = ["vision"]

[[example]]
name = "depth-anything"
required-features = ["vision"]

[[example]]
name = "depth-pro"
required-features = ["vision"]

[[example]]
name = "dinov2"
required-features = ["vision"]

[[example]]
name = "dinov3"
required-features = ["vision"]

[[example]]
name = "doclayout-yolo"
required-features = ["vision"]

[[example]]
name = "dwpose"
required-features = ["vision"]

[[example]]
name = "fast"
required-features = ["vision"]

[[example]]
name = "fastsam"
required-features = ["vision"]

[[example]]
name = "fastvlm"
required-features = ["vlm"]

[[example]]
name = "florence2"
required-features = ["vlm"]

[[example]]
name = "grounding-dino"
required-features = ["vlm"]

[[example]]
name = "linknet"
required-features = ["vision"]

[[example]]
name = "mediapipe-selfie-segmentation"
required-features = ["vision"]

[[example]]
name = "modnet"
required-features = ["vision"]

[[example]]
name = "moondream2"
required-features = ["vlm"]

[[example]]
name = "owlv2"
required-features = ["vlm"]

[[example]]
name = "picodet-layout"
required-features = ["vision"]

[[example]]
name = "rfdetr"
required-features = ["vision"]

[[example]]
name = "rmbg"
required-features = ["vision"]

[[example]]
name = "rtdetr"
required-features = ["vision"]

[[example]]
name = "ultralytics-rtdetr"
required-features = ["vision"]

[[example]]
name = "rtmo"
required-features = ["vision"]

[[example]]
name = "rtmpose"
required-features = ["vision"]

[[example]]
name = "rtmw"
required-features = ["vision"]

[[example]]
name = "sam"
required-features = ["vision"]

[[example]]
name = "sam2"
required-features = ["vision"]

[[example]]
name = "sam3"
required-features = ["vlm"]

[[example]]
name = "sapiens"
required-features = ["vision"]

[[example]]
name = "slanet"
required-features = ["vision"]

[[example]]
name = "smolvlm"
required-features = ["vlm"]

[[example]]
name = "svtr"
required-features = ["vision"]

[[example]]
name = "swin2sr"
required-features = ["vision"]

[[example]]
name = "trocr"
required-features = ["vlm"]

[[example]]
name = "yolo"
required-features = ["vision"]

[[example]]
name = "yolo-sam2"
required-features = ["vision"]

[[example]]
name = "yolo-track"
required-features = ["vision", "mot", "viewer"]

[[example]]
name = "yoloe-prompt"
required-features = ["vlm"]

[[example]]
name = "yoloe-prompt-free"
required-features = ["vlm"]

[[example]]
name = "yolop"
required-features = ["vision"]

[[example]]
name = "ram"
required-features = ["vision"]
